# Text mode installation uses less RAM
text

# Console and environment
keyboard --xlayouts=us
lang en_US.UTF-8
timezone Etc/UTC --utc

# network --bootproto=dhcp
url --mirrorlist="https://mirrors.fedoraproject.org/metalink?repo=fedora-$releasever&arch=$basearch"

bootloader --append="rhgb quiet crashkernel=1G-4G:192M,4G-64G:256M,64G-:512M"
zerombr
clearpart --all --initlabel

part /boot     --fstype=xfs   --size=1024 --fsoptions=nodev,nosuid
part /boot/efi --fstype=efi   --size=512  --fsoptions=nodev,nosuid,shortname=winnt,umask=0077
part pv.001    --fstype=lvmpv --grow

volgroup root pv.001

logvol /home          --fstype=xfs --size=1024   --vgname=root --name=home          --fsoptions=nodev,nosuid
logvol /var/log       --fstype=xfs --size=1024   --vgname=root --name=var_log       --fsoptions=nodev,noexec,nosuid
logvol /var/log/audit --fstype=xfs --size=1024   --vgname=root --name=var_log_audit --fsoptions=nodev,noexec,nosuid
logvol /var/tmp       --fstype=xfs --size=1024   --vgname=root --name=var_tmp       --fsoptions=nodev,noexec,nosuid
logvol /var           --fstype=xfs --size=3072   --vgname=root --name=var           --fsoptions=nodev,nosuid
logvol /              --fstype=xfs --percent=100 --vgname=root --name=root

rootpw --lock
user --groups=wheel --name=dh --password=ChangeMe
sshkey --username=dh "ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBHeId7Tvt4q9OkBykR3zGShgxhX94sO2+G2oJIDm5GI4M+2GwJn6cfHzLthVzdRu+lB931yznpKJMT3JM5x0QCQ="

%addon com_redhat_kdump --enable
%end

%packages
@core
@guest-agents
%end

selinux --enforcing
firewall --enabled --ssh
firstboot --disable
reboot --eject

%post
echo "PasswordAuthentication no" > /etc/ssh/sshd_config.d/99-homelab.conf
echo "\4" >> /etc/issue
%end
